<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>ModeSolvers-Tutorial · Opticalfibers.jl</title><meta name="title" content="ModeSolvers-Tutorial · Opticalfibers.jl"/><meta property="og:title" content="ModeSolvers-Tutorial · Opticalfibers.jl"/><meta property="twitter:title" content="ModeSolvers-Tutorial · Opticalfibers.jl"/><meta name="description" content="Documentation for Opticalfibers.jl."/><meta property="og:description" content="Documentation for Opticalfibers.jl."/><meta property="twitter:description" content="Documentation for Opticalfibers.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/citations.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Opticalfibers.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../Common/">Common functions</a></li><li><a class="tocitem" href="../PhysicalData/">PhysicalData</a></li><li class="is-active"><a class="tocitem" href>ModeSolvers-Tutorial</a><ul class="internal"><li><a class="tocitem" href="#Bimodal-Step-index-Fiber"><span>Bimodal Step-index Fiber</span></a></li><li><a class="tocitem" href="#Gradient-index-fiber"><span>Gradient index fiber</span></a></li><li><a class="tocitem" href="#FEM:-Step-index-fiber"><span>FEM: Step-index fiber</span></a></li><li><a class="tocitem" href="#Leaky-modes-in-step-index-fiber-with-a-low-index-trench"><span>Leaky modes in step index fiber with a low index trench</span></a></li><li><a class="tocitem" href="#FEM:-Photonic-Crystal-Fiber"><span>FEM: Photonic Crystal Fiber</span></a></li></ul></li><li><a class="tocitem" href="../ModeSolvers-Solvers/">ModeSolvers-Solvers</a></li><li><a class="tocitem" href="../ModeSolvers/">ModeSolvers-Modes and Fields</a></li><li><a class="tocitem" href="../Bibliography/">Bibliography</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>ModeSolvers-Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>ModeSolvers-Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ovanvincq/OpticalFibers.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ovanvincq/OpticalFibers.jl/blob/main/docs/src/ModeSolvers-Tutorial.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="OpticalFibers.ModeSolvers-Tutorial"><a class="docs-heading-anchor" href="#OpticalFibers.ModeSolvers-Tutorial">OpticalFibers.ModeSolvers - Tutorial</a><a id="OpticalFibers.ModeSolvers-Tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#OpticalFibers.ModeSolvers-Tutorial" title="Permalink"></a></h1><h2 id="Bimodal-Step-index-Fiber"><a class="docs-heading-anchor" href="#Bimodal-Step-index-Fiber">Bimodal Step-index Fiber</a><a id="Bimodal-Step-index-Fiber-1"></a><a class="docs-heading-anchor-permalink" href="#Bimodal-Step-index-Fiber" title="Permalink"></a></h2><p>This section explains how to modelize a step-index fiber with a core radius <span>$a=2$</span> µm. The refractive index of the core is <span>$n_{\text{core}}=1.47$</span> and that of the cladding is <span>$n_{\text{cladding}}=1.45$</span>. </p><p>This fiber is bimodal at <span>$\lambda=1$</span> µm since the normalized frequency is <span>$V=\frac{2\pi a}{\lambda}\sqrt{n_{\text{core}}^2-n_{\text{cladding}}^2}=3.04$</span>. </p><p>To compute the two modes, we can use the fuction <code>multi_step_fiber_modes</code> that returns a vector of modes:</p><pre><code class="language-julia hljs">using OpticalFibers
using OpticalFibers.ModeSolvers
m0=multi_step_fiber_modes(1,0,2,[1.47,1.45],maxPosition=10);
m01=m0[1]
m1=multi_step_fiber_modes(1,1,2,[1.47,1.45],maxPosition=10);
m11=m1[1]</code></pre><p>Note that you can also use broadcasting to compute all modes with a single command:</p><pre><code class="language-julia hljs">m=multi_step_fiber_modes.(1,[0,1],2,Ref([1.47,1.45]),maxPosition=10);
m01=m[1][1];
m11=m[2][1];</code></pre><p>It is possible to plot the mode profile:</p><pre><code class="language-julia hljs">using Plots
plot(m01.r,m01.E,label=m01.Name)
plot!(m11.r,m11.E,label=m11.Name)</code></pre><img src="bfed8bff.svg" alt="Example block output"/><p>In order to visualize the modes in a 2D plot, one should use the conversion from <code>ScalarMode1D</code> to <code>ScalarMode2D</code>. Be careful when using <code>Plots.jl</code>: unlike this package, the second index of the matrix corresponds to the x-coordinate (as matlab but the opposite of <code>Makie.jl</code>).</p><pre><code class="language-julia hljs">mm01=ScalarMode2D(m01);
mm11s=ScalarMode2D(m11,sincos=&#39;s&#39;);
mm11c=ScalarMode2D(m11,sincos=&#39;c&#39;);
contourf(mm11c.x,mm11c.y,mm11c.E&#39;,levels=100,linewidth=0)</code></pre><img src="38b55025.svg" alt="Example block output"/><p>To observe the beating between the LP01 and the LP11, the modes must be first normalized. Then, the addition of the two fields at the distance z ∈ [0,214] µm is required. The beating length is <span>$\frac{2\pi}{\vert \Delta \beta \vert} = \frac{\lambda}{\vert \Delta n_{eff} \vert}= 107$</span> µm</p><pre><code class="language-julia hljs">normalize!(mm01)
normalize!(mm11c)
normalize!(mm11s)
L=1/(m01.neff-m11.neff)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">106.89413338381357</code></pre><pre><code class="language-julia hljs">anim=@animate for j=0:214
    TotalField=ScalarField(mm01,j)+ScalarField(mm11c,j);
    contourf(TotalField.x,TotalField.y,abs2.(TotalField.E&#39;),levels=100,linewidth=0)
    title!(&quot;z = $j µm&quot;);
end;
gif(anim,&quot;anim_field.gif&quot;,fps=15)</code></pre><img src="e640628f.gif" alt="Example block output"/><p>It is also possible to compute the vector modes of the fiber: LP<span>$_{01}$</span> mode becomes HE<span>$_{11}$</span> mode and LP<span>$_{11}$</span> mode becomes TE<span>$_{01}$</span>, TM<span>$_{01}$</span> and HE<span>$_{21}$</span> modes:</p><pre><code class="language-julia hljs">mv0=multi_step_fiber_modes(1,0,2,[1.47,1.45],maxPosition=10,type=:Vector)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2-element Vector{OpticalFibers.ModeSolvers.VectorMode}:
 [&quot;TE 0,1&quot;,1.4538242972550153,1.0,[-10.0,10.0],[-10.0,10.0],[0.0,6423.6614554249545],[0.0,6423.6614554249545],[0.0,0.0],[0.0,24.789284967112515],[0.0,24.789284967112515],[0.00012875788049931844,6.377844605026284]]
 [&quot;TM 0,1&quot;,1.4537675924414297,1.0,[-10.0,10.0],[-10.0,10.0],[0.0,24.42836657241584],[0.0,24.42836657241584],[0.00013675448062861948,6.295547609080464],[0.0,0.09638368964539565],[0.0,0.09638368964539565],[0.0,0.0]]</code></pre><pre><code class="language-julia hljs">mv1=multi_step_fiber_modes(1,1,2,[1.47,1.45],maxPosition=10,type=:Vector)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2-element Vector{OpticalFibers.ModeSolvers.VectorMode}:
 [&quot;HE 1,1b&quot;,1.4631371608572663,1.0,[-10.0,10.0],[-10.0,10.0],[8.057716514469458e-7,17.659086281383395],[0.0,0.058526627904333495],[0.0,0.9951907653396004],[0.0,0.00019811180383880883],[3.1013310034567737e-9,0.06890799118005245],[0.0,0.0038278584364929836]]
 [&quot;HE 1,1a&quot;,1.4631371608572663,1.0,[-10.0,10.0],[-10.0,10.0],[0.0,0.058526627904333495],[8.057716514469458e-7,17.65908628138339],[0.0,0.9951907653396004],[3.1013310034567737e-9,0.06890799118005245],[0.0,0.00019811180383880883],[0.0,0.0038278584364929836]]</code></pre><pre><code class="language-julia hljs">mv2=multi_step_fiber_modes(1,2,2,[1.47,1.45],maxPosition=10,type=:Vector)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2-element Vector{OpticalFibers.ModeSolvers.VectorMode}:
 [&quot;HE 2,1b&quot;,1.4537386807206427,1.0,[-10.0,10.0],[-10.0,10.0],[0.0,8.179144249930044],[0.0,8.179144249930044],[0.0,0.9771916358220737],[0.0,0.03185727422052806],[0.0,0.03185727422052806],[0.0,0.0038464075287345184]]
 [&quot;HE 2,1a&quot;,1.4537386807206427,1.0,[-10.0,10.0],[-10.0,10.0],[0.0,8.183586213971765],[0.0,8.183586213971765],[0.0,0.9999752349350604],[0.0,0.03199511348865891],[0.0,0.03199511348865891],[0.0,0.0037587703512342654]]</code></pre><p>Then, the Poynting Vector of the mode HE<span>$_{21}$</span> can be computed and plotted:</p><pre><code class="language-julia hljs">Px,Py,Pz=PoyntingVector(mv2[1]);
contourf(mv2[1].x,mv2[1].y,Pz&#39;,linewidth=0,levels=100,xlims=(-4,4),ylims=(-4,4))
X,Y=meshgrid(mv2[1].x,mv2[1].y);
quiver!(X[5:5:end,5:5:end],Y[5:5:end,5:5:end],quiver=(mv2[1].Ex[5:5:end,5:5:end]&#39;/20,mv2[1].Ey[5:5:end,5:5:end]&#39;/20),color=:cyan,arrow=arrow(:closed))</code></pre><img src="46709544.svg" alt="Example block output"/><p>In order to check the orthoganality of the modes, we can normalize them and compute the overlap integrals:</p><pre><code class="language-julia hljs">mv=[mv0;mv1;mv2];
normalize!.(mv);
overlap.(mv,transpose(mv))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">6×6 Matrix{Float64}:
  1.0           4.63133e-19   1.57427e-17  …  -2.58123e-18  -4.71317e-17
 -4.63382e-19   1.0          -8.98729e-17      6.45827e-17  -4.35753e-18
 -2.52165e-19  -8.30757e-17   1.0              9.494e-17     5.69264e-18
 -4.61124e-17  -5.7172e-18   -4.96938e-19      1.11981e-17  -4.14427e-17
 -2.22809e-18  -9.38509e-18   2.16632e-17      1.0           2.08712e-19
  6.96282e-17  -5.02604e-18  -5.97523e-19  …  -7.89018e-19   1.0</code></pre><h2 id="Gradient-index-fiber"><a class="docs-heading-anchor" href="#Gradient-index-fiber">Gradient index fiber</a><a id="Gradient-index-fiber-1"></a><a class="docs-heading-anchor-permalink" href="#Gradient-index-fiber" title="Permalink"></a></h2><p>In this tutorial, a germanium-doped parabolic gradient index fiber will be studied. The maximum Ge concentration is 20% and the core radius is 3.5 µm. The silica dispersion will be taken into account.</p><p>First, a vector of <code>Function</code> is created to modelized the dispersive refractive index profile between 1 and 1.5 µm:</p><pre><code class="language-julia hljs">using OpticalFibers
using OpticalFibers.PhysicalData
using Plots
lambda=1:0.01:1.5;
f=[r-&gt;n_Ge_Doped_Silica(l*1e-6,0)+(n_Ge_Doped_Silica(l*1e-6,0.2)-n_Ge_Doped_Silica(l*1e-6,0))*(r&lt;=3.5)*(1-r^2/3.5^2) for l in lambda];
r=0:0.1:5;
plot(r,f[1].(r),label=&quot;λ = 1 µm&quot;,xlabel=&quot;r (µm)&quot;,ylabel=&quot;Refractive index&quot;);
plot!(r,f[end].(r),label=&quot;λ = 1.5 µm&quot;)</code></pre><img src="79c12f23.svg" alt="Example block output"/><p>The modal content is then computed:</p><pre><code class="language-julia hljs">using OpticalFibers.ModeSolvers
m=FD.(lambda,[0,1,2]&#39;,2,f,1000,10);
#mode LP01 always exists
neff01=[m[j,1][1].neff for j in 1:length(lambda)];
N02=sum((length.(m[:,1])).&gt;=2);
neff02=[m[j,1][2].neff for j in 1:N02];
N11=sum((length.(m[:,2])).&gt;=1);
neff11=[m[j,2][1].neff for j in 1:N11];
N21=sum((length.(m[:,3])).&gt;=1);
neff21=[m[j,3][1].neff for j in 1:N21];
plot(lambda,n_Ge_Doped_Silica.(lambda*1E-6,0),label=&quot;Silica&quot;,xlabel=&quot;λ (µm)&quot;,ylabel=&quot;Effective index&quot;,color=:black);
plot!(lambda,n_Ge_Doped_Silica.(lambda*1E-6,0.2),label=&quot;Ge-doped Silica (20%)&quot;,color=:black,line=:dash);
plot!([lambda,lambda[1:N11],lambda[1:N02],lambda[1:N21]],[neff01,neff11,neff02,neff21],label=[&quot;LP01&quot; &quot;LP11&quot; &quot;LP02&quot; &quot;LP21&quot;])</code></pre><img src="722bd610.svg" alt="Example block output"/><p>The second-order dispersion is defined by <span>$\beta_2=\frac{\partial^2 \beta}{\partial \omega^2}$</span>.</p><pre><code class="language-julia hljs">beta01=neff01*2*pi./lambda*1E6;
omega=2*pi*OpticalFibers.PhysicalData.c./lambda*1E6;
omega2,beta2=derivative((omega,beta01),2);
lambda2=2*pi*OpticalFibers.PhysicalData.c./omega2*1E6;
plot(lambda2,beta2*1E26,xlabel=&quot;λ (µm)&quot;,ylabel=&quot;β₂ (10⁻²⁶ s²/m)&quot;)</code></pre><img src="15f4204e.svg" alt="Example block output"/><p>To compute the effective area and the non-linear coefficient, the fields must be calculated:</p><pre><code class="language-julia hljs">m=FD.(lambda,0,1,f,1000,10,field=true);
m=[m[i][1] for i in 1:length(lambda)];
A=Aeff.(m);
gamma=nonLinearCoefficient.(m,2.53E-20)*1E21;
plot(lambda,A,label=&quot;Aeff&quot;,ylabel=&quot;Effective area (µm²)&quot;,xlabel=&quot;λ (µm)&quot;,color=:blue,leg=:topright);
plot!(twinx(),lambda,gamma,label=&quot;γ&quot;,ylabel=&quot;Non-linear coefficient ((W.km)⁻¹)&quot;,color=:red,leg=:topleft)</code></pre><img src="011c4c06.svg" alt="Example block output"/><h2 id="FEM:-Step-index-fiber"><a class="docs-heading-anchor" href="#FEM:-Step-index-fiber">FEM: Step-index fiber</a><a id="FEM:-Step-index-fiber-1"></a><a class="docs-heading-anchor-permalink" href="#FEM:-Step-index-fiber" title="Permalink"></a></h2><p>As an example, we will compute the five first vector modes in a step-index fiber with a 1 µm-core radius, a refractive index of <span>$\sqrt{3}$</span> in the core and 1 in the cladding. The mesh was generated with GMSH.</p><pre><code class="language-julia hljs">using OpticalFibers
using OpticalFibers.ModeSolvers
using Gridap
using GridapGmsh
using GridapMakie
using GLMakie
model = GmshDiscreteModel(&quot;../../models/Step_index_fiber.msh&quot;);
permittivity=x-&gt;1+2*(x[1]^2+x[2]^2&lt;=1);
m=FEM(1,5,permittivity,model,sqrt(3),order=2,solver=:MUMPS,field=true,type=:Vector);
fig,ax,plot_obj=wireframe(m[1].Ω, color=:black, linewidth=2,axis=(aspect=DataAspect(),))
ax.xlabel=&quot;x (µm)&quot;;
ax.ylabel=&quot;y (µm)&quot;;</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Info    : Reading &#39;../../models/Step_index_fiber.msh&#39;...
Info    : 7 entities
Info    : 5178 nodes
Info    : 10454 elements
Info    : Done reading &#39;../../models/Step_index_fiber.msh&#39;</code></pre><p><img src="../FEM1_mesh.png" alt="Pz for FM computed with FEM"/></p><p>Now we can plot the z-component of the Poynting Vector with the package GridapMakie.jl (it is also possible to save the field in a vtk file with the funcion <code>writevtk</code> implemented in Gridap.jl and open it with ParaView):</p><pre><code class="language-julia hljs">Px,Py,Pz=PoyntingVector(m[1]);
fig,ax,plot_obj=GLMakie.plot(m[1].Ω,Pz,axis=(aspect=DataAspect(),),colormap=:jet)
ax.xlabel=&quot;x (µm)&quot;;
ax.ylabel=&quot;y (µm)&quot;;
ax.title=&quot;neff = $(real(m[1].neff))&quot;;
Colorbar(fig[1,2], plot_obj);</code></pre><p><img src="../FEM1_Pz.png" alt="Pz for FM computed with FEM"/></p><h2 id="Leaky-modes-in-step-index-fiber-with-a-low-index-trench"><a class="docs-heading-anchor" href="#Leaky-modes-in-step-index-fiber-with-a-low-index-trench">Leaky modes in step index fiber with a low index trench</a><a id="Leaky-modes-in-step-index-fiber-with-a-low-index-trench-1"></a><a class="docs-heading-anchor-permalink" href="#Leaky-modes-in-step-index-fiber-with-a-low-index-trench" title="Permalink"></a></h2><p>In this example, we study a fiber with the parameters below:</p><ul><li>core with a radius of 4 µm and a refractive index of 1.46</li><li>a trench located between 4 µm and 7 µm with a refractive index of 1.41</li><li>a cladding with a refractive index of 1.45</li></ul><p>In order to compute the leaky scalar modes at <span>$\lambda=1.6$</span> µm, a PML must be added when using the 1-dimensional FD solver. The PML will be located between 12 µm and 15 µm.</p><pre><code class="language-julia hljs">using OpticalFibers
using OpticalFibers.ModeSolvers
f=r-&gt;1.46-0.05*(r&lt;=7)*(r&gt;=4)-0.01*(r&gt;7);
m0=FD(1.6,0,10,f,1000,15,field=true,rPML=12)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">10-element Vector{OpticalFibers.ModeSolvers.ScalarMode1D}:
 [&quot;LP - ℓ=0 - mode 1&quot;,1.4541275200015011 - 3.0612847211108235e-10im,1.6,0,[0.0,15.0],[1.2158554570008087e-6,0.08223100114087857]]
 [&quot;LP - ℓ=0 - mode 2&quot;,1.4501373593537188 - 0.0011228765326362277im,1.6,0,[0.0,15.0],[8.582955321635607e-5,0.06212733786278288]]
 [&quot;LP - ℓ=0 - mode 3&quot;,1.4509918101445345 - 0.004676410456531937im,1.6,0,[0.0,15.0],[0.0001796257707576037,0.07289870728172958]]
 [&quot;LP - ℓ=0 - mode 4&quot;,1.4536668158731394 - 0.013322735788541897im,1.6,0,[0.0,15.0],[4.422147430513367e-5,0.08840337628196542]]
 [&quot;LP - ℓ=0 - mode 5&quot;,1.4491364875431956 - 0.012669319291743624im,1.6,0,[0.0,15.0],[0.00010866610045382322,0.0849585716700037]]
 [&quot;LP - ℓ=0 - mode 6&quot;,1.4626515857561284 - 0.02411901670883042im,1.6,0,[0.0,15.0],[1.6100410567031685e-6,0.09860627819917317]]
 [&quot;LP - ℓ=0 - mode 7&quot;,1.429895910247082 - 3.8037961782829047e-5im,1.6,0,[0.0,15.0],[4.002530436491718e-8,0.11089271188749458]]
 [&quot;LP - ℓ=0 - mode 8&quot;,1.4750302299823312 - 0.03689473074360324im,1.6,0,[0.0,15.0],[4.526339878536927e-8,0.10554635657737957]]
 [&quot;LP - ℓ=0 - mode 9&quot;,1.4321915921204398 - 0.02964845152566257im,1.6,0,[0.0,15.0],[3.587032257272174e-6,0.09396032736598095]]
 [&quot;LP - ℓ=0 - mode 10&quot;,1.4912962978621942 - 0.051527442488204865im,1.6,0,[0.0,15.0],[1.1335356147783201e-9,0.11100627914696418]]</code></pre><p>The LP01 mode is the mode 1. Since its effective index is greater than the refractive index of the cladding, this mode is guided and its losses are not significant.</p><p>The LP02 mode is the mode 7, its losses in dB/km can be calculated:</p><pre><code class="language-julia hljs">losses(m0[7])*1e6</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1.2974523901207896e6</code></pre><pre><code class="language-julia hljs">using Plots
plot(m0[1].r,-real.(m0[1].E),xlabel=&quot;r (µm)&quot;,ylabel=&quot;real(E)&quot;,label=&quot;LP01&quot;)
plot!(m0[7].r,-real.(m0[7].E),label=&quot;LP02&quot;)</code></pre><img src="4de2abea.svg" alt="Example block output"/><p>We can also compute the effective index of the LP11 mode:</p><pre><code class="language-julia hljs">m1=FD(1.6,1,10,f,1000,15,field=true,rPML=12)
pos=argmin(losses.(m1)*1E6);
m1[pos].neff</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1.4452235104934343 - 2.3339462583295887e-6im</code></pre><p>To compute the leaky vector modes that correspond to the LP11 mode, we can add a PML for the FEM solver:</p><pre><code class="language-julia hljs">using Gridap
using GridapGmsh
model = GmshDiscreteModel(&quot;../../models/Step_index_fiber_pml.msh&quot;);
permittivity=x-&gt;f(hypot(x[1],x[2]))^2;
epsilon=add_cylindrical_PML(permittivity,12,3,10);
mu=add_cylindrical_PML(x-&gt;1.0,12,3,10);
m=FEM(1.6,4,epsilon,mu,model,real(m1[pos].neff),field=true,order=2,solver=:MUMPS)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">4-element Vector{OpticalFibers.ModeSolvers.VectorModeFEM}:
 [Mode 1,1.445200657509651 - 2.375526799223427e-6im,1.6,yes]
 [Mode 2,1.4450417028836748 - 2.377080667967091e-6im,1.6,yes]
 [Mode 3,1.4450417028245284 - 2.3770806385882935e-6im,1.6,yes]
 [Mode 4,1.4449793146581011 - 2.351222270804991e-6im,1.6,yes]</code></pre><p>The field can be plotted using GridapMakie or saved (using the function &#39;writevtk&#39;) to a file that can be opened with ParaView.</p><pre><code class="language-julia hljs">using GridapMakie
using GLMakie
fig,ax,plot_obj=GLMakie.plot(m[end].Ω,real(m[1].Ex),axis=(aspect=DataAspect(),),colormap=:jet)
Colorbar(fig[1,2], plot_obj);</code></pre><p><img src="../FEM_PML_Ex.png" alt="Real(Ex) for the first mode"/></p><h2 id="FEM:-Photonic-Crystal-Fiber"><a class="docs-heading-anchor" href="#FEM:-Photonic-Crystal-Fiber">FEM: Photonic Crystal Fiber</a><a id="FEM:-Photonic-Crystal-Fiber-1"></a><a class="docs-heading-anchor-permalink" href="#FEM:-Photonic-Crystal-Fiber" title="Permalink"></a></h2><p>In a PCF, the modes are not guided modes but leaky modes so that the computation requires a PML. The fiber is constituted of three rings of air hole (n=1) inserted in silica (n=1.45). The pitch is 2 µm, the hole diameter is 1.5 µm and the PML begins at 8 µm from the fiber center and its thickness is 2 µm. </p><p><img src="../assets/PCF.png" alt="PCF mesh"/></p><p>First, the mesh is loaded:</p><pre><code class="language-julia hljs">using OpticalFibers
using OpticalFibers.ModeSolvers
using Gridap
using GridapGmsh
using GridapMakie
using GLMakie
model = GmshDiscreteModel(&quot;../../models/PCF.msh&quot;);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">UnstructuredDiscreteModel()</code></pre><p>Then we define the permittivity function and add a PML to obtain the final permittivity and permeability tensors:</p><pre><code class="language-julia hljs">function eps_PCF(x)
    Pitch=2;
    r_hole=0.75;
    x1,y1=ring(1);
    x2,y2=ring(2);
    x3,y3=ring(3);
    xc=[x1;x2;x3]*Pitch;
    yc=[y1;y2;y3]*Pitch;
    for i=1:length(xc)
        rc=hypot(x[1]-xc[i],x[2]-yc[i]);
        if rc&lt;r_hole
            return 1.0;
        end
    end
    return 1.45^2;
end
epsilon=add_cylindrical_PML(eps_PCF,8,2,10);
mu=add_cylindrical_PML(x-&gt;1.0,8,2,10);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">tensor3(OpticalFibers.var&quot;#pml_xx#40&quot;{Main.var&quot;#1#2&quot;, Int64, Int64, Int64}(Main.var&quot;#1#2&quot;(), 8, 2, 10), OpticalFibers.var&quot;#pml_xy#43&quot;{Main.var&quot;#1#2&quot;, Int64, Int64, Int64}(Main.var&quot;#1#2&quot;(), 8, 2, 10), OpticalFibers.var&quot;#zf#44&quot;(), OpticalFibers.var&quot;#pml_xy#43&quot;{Main.var&quot;#1#2&quot;, Int64, Int64, Int64}(Main.var&quot;#1#2&quot;(), 8, 2, 10), OpticalFibers.var&quot;#pml_yy#41&quot;{Main.var&quot;#1#2&quot;, Int64, Int64, Int64}(Main.var&quot;#1#2&quot;(), 8, 2, 10), OpticalFibers.var&quot;#zf#44&quot;(), OpticalFibers.var&quot;#zf#44&quot;(), OpticalFibers.var&quot;#zf#44&quot;(), OpticalFibers.var&quot;#pml_zz#42&quot;{Main.var&quot;#1#2&quot;, Int64, Int64, Int64}(Main.var&quot;#1#2&quot;(), 8, 2, 10))</code></pre><p>Then we can compute ten modes whose effective indices are close to the approximate value calculated for the fundamental mode at the wavelength of 1.3 µm:</p><pre><code class="language-julia hljs">neff_approx=approx_neff_PCF(1.3,1.5,2);
m=FEM(1.3,10,epsilon,mu,model,neff_approx,field=true,order=2,solver=:MUMPS)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">10-element Vector{OpticalFibers.ModeSolvers.VectorModeFEM}:
 [Mode 1,1.4224235276324437 - 0.02282658885887404im,1.3,yes]
 [Mode 2,1.422646358883874 - 0.022748925822529863im,1.3,yes]
 [Mode 3,1.4228688953469115 - 0.022504192474910197im,1.3,yes]
 [Mode 4,1.4228719980417501 - 0.02250363648884228im,1.3,yes]
 [Mode 5,1.4288548628513194 - 0.019655111771513727im,1.3,yes]
 [Mode 6,1.4287878999964918 - 0.01950714145630964im,1.3,yes]
 [Mode 7,1.4287883247324005 - 0.01950659185061394im,1.3,yes]
 [Mode 8,1.4292043041127571 - 0.018908437349998048im,1.3,yes]
 [Mode 9,1.4134836231922907 - 4.346077578897855e-14im,1.3,yes]
 [Mode 10,1.4134823818567004 - 4.355971503581387e-14im,1.3,yes]</code></pre><p>The last two modes are fundamental modes. We can compute and plot the z-component of the Poynting vector of the last mode:</p><pre><code class="language-julia hljs">Px,Py,Pz=PoyntingVector(m[end]);
fig,ax,plot_obj=GLMakie.plot(m[end].Ω,Pz,axis=(aspect=DataAspect(),),colormap=:jet)
ax.xlabel=&quot;x (µm)&quot;;
ax.ylabel=&quot;y (µm)&quot;;
ax.title=&quot;neff = $(m[end].neff)&quot;;
Colorbar(fig[1,2], plot_obj);</code></pre><p><img src="../FEM2_Pz.png" alt="Pz for FM computed with FEM"/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../PhysicalData/">« PhysicalData</a><a class="docs-footer-nextpage" href="../ModeSolvers-Solvers/">ModeSolvers-Solvers »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Wednesday 24 January 2024 10:17">Wednesday 24 January 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
